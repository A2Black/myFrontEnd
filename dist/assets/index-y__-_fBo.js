import{i as D}from"./index-Cyc5mHF5.js";import{d as I,r as C,a as P,c as h,F as T,b as e,e as r,w as o,o as E,f as a,g as v,E as w,u as B,_ as L}from"./index-DAzvbAht.js";import{l as R}from"./login_log-LTTSzmh3.js";import{u as F}from"./userinfo-DTtnKP-y.js";import"./userinfor-5i_LEdTx.js";const M=_=>{const{account:d,password:c}=_;return D({url:"api/register",method:"POST",data:{account:d,password:c}})},W=_=>{const{account:d,password:c}=_;return D({url:"/api/login",method:"POST",data:{account:d,password:c}})},j=_=>{const{account:d,email:c}=_;return D({url:"user/verifyAccountAndEmail",method:"POST",data:{account:d,email:c}})},z=(_,d)=>D({url:"user/changePasswordInLogin",method:"POST",data:{id:_,newPassword:d}}),G={class:"dialog-footer"},H={class:"dialog-footer"},J=I({__name:"foget_password",setup(_,{expose:d}){const c=C("top"),u=P({account:null,email:"",password:"",repassword:""}),n=P({forgetPasswordDialog:!1,changePasswordDialog:!1});d({open:()=>{n.forgetPasswordDialog=!0}});const k=async()=>{const V=await j(u);V.status==0?(w({message:"验证成功！",type:"success"}),localStorage.setItem("id",V.id),n.forgetPasswordDialog=!1,n.changePasswordDialog=!0):w.error("验证失败")},U=async()=>{if(u.password==u.repassword){const V=u.repassword;await z(localStorage.getItem("id"),V),w({message:"重置成功！",type:"success"})}else w.error("重置失败，请检查两次密码输入是否一致")},y=P({account:[{required:!0,message:"请输入您的账号",trigger:"blur"}],email:[{required:!0,message:"请输入您的个人邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入您的新密码",trigger:"blur"}],repassword:[{required:!0,message:"再次输入密码以确认更改",trigger:"blur"}]});return(V,s)=>{const i=r("el-input"),l=r("el-form-item"),b=r("el-form"),p=r("el-button"),g=r("el-dialog");return E(),h(T,null,[e(g,{modelValue:n.forgetPasswordDialog,"onUpdate:modelValue":s[3]||(s[3]=t=>n.forgetPasswordDialog=t),title:"忘记密码",width:"500"},{footer:o(()=>[a("div",G,[e(p,{onClick:s[2]||(s[2]=t=>n.forgetPasswordDialog=!1)},{default:o(()=>s[8]||(s[8]=[v("取消")])),_:1}),e(p,{type:"primary",onClick:k},{default:o(()=>s[9]||(s[9]=[v(" 下一步 ")])),_:1})])]),default:o(()=>[e(b,{class:"login-form","label-width":"auto",style:{"max-width":"400px"},"label-position":c.value,rules:y},{default:o(()=>[e(l,{label:"请输入你的注册账号",prop:"account"},{default:o(()=>[e(i,{modelValue:u.account,"onUpdate:modelValue":s[0]||(s[0]=t=>u.account=t),placeholder:"请输入你的注册账号"},null,8,["modelValue"])]),_:1}),e(l,{label:"请输入你的个人邮箱",prop:"email"},{default:o(()=>[e(i,{modelValue:u.email,"onUpdate:modelValue":s[1]||(s[1]=t=>u.email=t),placeholder:"请输入你的个人邮箱"},null,8,["modelValue"])]),_:1})]),_:1},8,["label-position","rules"])]),_:1},8,["modelValue"]),e(g,{modelValue:n.changePasswordDialog,"onUpdate:modelValue":s[7]||(s[7]=t=>n.changePasswordDialog=t),title:"修改密码",width:"500"},{footer:o(()=>[a("div",H,[e(p,{onClick:s[6]||(s[6]=t=>n.changePasswordDialog=!1)},{default:o(()=>s[10]||(s[10]=[v("取消")])),_:1}),e(p,{type:"primary",onClick:U},{default:o(()=>s[11]||(s[11]=[v(" 确认 ")])),_:1})])]),default:o(()=>[e(b,{class:"login-form","label-width":"auto",style:{"max-width":"400px"},"label-position":c.value,rules:y},{default:o(()=>[e(l,{label:"请输入你的新密码",prop:"passwo"},{default:o(()=>[e(i,{modelValue:u.password,"onUpdate:modelValue":s[4]||(s[4]=t=>u.password=t),placeholder:"请输入你的新密码","show-password":""},null,8,["modelValue"])]),_:1}),e(l,{label:"请再次输入你的新密码",prop:"repassw"},{default:o(()=>[e(i,{modelValue:u.repassword,"onUpdate:modelValue":s[5]||(s[5]=t=>u.repassword=t),placeholder:"请再次输入你的新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["label-position","rules"])]),_:1},8,["modelValue"])],64)}}}),K={class:"common-layout"},Q={class:"login-wrapped"},X={class:"footer-wrapped"},Y={class:"footer-button"},Z={class:"footer-button"},ee=I({__name:"index",setup(_){const d=C("first"),c=B(),u=F(),n=P({account:null,password:""}),f=P({account:null,password:"",repassword:""}),k=async()=>{const i=await W(n);if(i.message=="登录成功"){const{id:l,name:b,account:p,email:g,department:t}=i.results,{token:x}=i;w({message:"登录成功！",type:"success"}),await R(p,b,g),localStorage.setItem("id",l),localStorage.setItem("name",b),localStorage.setItem("department",t),localStorage.setItem("token",x),u.userInfo(l),c.push("/home")}else w.error("登录失败，请检查账号和密码是否正确！")},U=async()=>{if(f.password==f.repassword){const i=await M(f);i.message=="注册账号成功"?(w({message:"恭喜，注册成功！",type:"success"}),d.value="first"):i.message=="账号已存在"?w({message:"账号已存在！",type:"warning"}):w.error("注册失败，请检查输入数据是否正确")}else w.error("两次密码不一致，请重新输入！")},y=C(),V=()=>{y.value.open()},s=()=>{d.value="second"};return(i,l)=>{const b=r("el-header"),p=r("el-input"),g=r("el-form-item"),t=r("el-button"),x=r("el-form"),S=r("el-tab-pane"),$=r("el-tabs"),q=r("el-card"),A=r("el-main"),N=r("el-footer"),O=r("el-container");return E(),h(T,null,[a("div",K,[e(O,null,{default:o(()=>[e(b,{class:"header-wrapped"},{default:o(()=>l[6]||(l[6]=[a("div",{class:"header-content"},[a("h2",null," 星海后台管理系统 "),a("span",{class:"welcome"},"尊敬的领航员,欢迎你的登录")],-1)])),_:1}),e(A,null,{default:o(()=>[a("div",Q,[e(q,{class:"box-card"},{default:o(()=>[e($,{modelValue:d.value,"onUpdate:modelValue":l[5]||(l[5]=m=>d.value=m),class:"demo-tabs",stretch:"true"},{default:o(()=>[e(S,{label:"登录",name:"first"},{default:o(()=>[e(x,{class:"login-form","label-width":"auto",style:{"max-width":"600px"}},{default:o(()=>[e(g,{label:"账号"},{default:o(()=>[e(p,{modelValue:n.account,"onUpdate:modelValue":l[0]||(l[0]=m=>n.account=m),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),e(g,{label:"密码"},{default:o(()=>[e(p,{modelValue:n.password,"onUpdate:modelValue":l[1]||(l[1]=m=>n.password=m),placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),a("div",X,[a("div",{class:"forget-password"},[a("span",{class:"forget-password-button",onClick:V},"忘记密码?")]),a("div",Y,[e(t,{type:"primary",onClick:k,round:""},{default:o(()=>l[7]||(l[7]=[v("登录")])),_:1})]),a("div",{class:"footer-go-register"},[l[8]||(l[8]=v(" 还没有账号?")),a("span",{class:"go-register",onClick:s},"马上注册")])])]),_:1})]),_:1}),e(S,{label:"注册",name:"second"},{default:o(()=>[e(x,{class:"login-form","label-width":"auto",style:{"max-width":"600px"}},{default:o(()=>[e(g,{label:"账号"},{default:o(()=>[e(p,{modelValue:f.account,"onUpdate:modelValue":l[2]||(l[2]=m=>f.account=m),placeholder:"账号长度为6-12位"},null,8,["modelValue"])]),_:1}),e(g,{label:"密码"},{default:o(()=>[e(p,{modelValue:f.password,"onUpdate:modelValue":l[3]||(l[3]=m=>f.password=m),placeholder:"密码长度为6-12位需含数字和字母"},null,8,["modelValue"])]),_:1}),e(g,{label:"确认密码"},{default:o(()=>[e(p,{modelValue:f.repassword,"onUpdate:modelValue":l[4]||(l[4]=m=>f.repassword=m),placeholder:"请再次输入密码"},null,8,["modelValue"])]),_:1}),a("div",Z,[e(t,{type:"primary",onClick:U,round:""},{default:o(()=>l[9]||(l[9]=[v("注册")])),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1}),e(N,{class:"footer-wrapped"},{default:o(()=>l[10]||(l[10]=[a("div",{class:"footer-content"},[a("div",{class:"title"},[a("span",null,"Technology saves the world!")])],-1)])),_:1})]),_:1})]),e(J,{ref_key:"fogetPass",ref:y},null,512)],64)}}}),re=L(ee,[["__scopeId","data-v-a2273983"]]);export{re as default};
