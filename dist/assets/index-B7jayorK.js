import{b as P}from"./mitt-CdlF-dbX.js";import{i as v}from"./index-uR4T4Urx.js";import{d as T,r as p,i as z,j as E,w as o,e as d,o as U,f as l,b as e,g as k,E as h,_ as V,a as A,c as M,F as j,t as L}from"./index-C-sImJSJ.js";import{b as K}from"./bread_crumb-CidfeB9Y.js";import"./SvgIcon-CJygAaLK.js";const q=(i,r)=>v({url:"file/bindFileAndUser",method:"POST",data:{name:i,url:r}}),G=(i,r)=>v({url:"file/updateDownload",method:"POST",data:{download_number:i,id:r}}),H=()=>v({url:"/file/fileListLength",method:"POST"}),S=i=>v({url:"file/returnFilesListData",method:"POST",data:{pager:i}}),J=(i,r)=>v({url:"file/deleteFile",method:"POST",data:{id:i,file_name:r}}),Q={class:"dialog-footer"},R=T({__name:"tips",emits:["success"],setup(i,{expose:r,emit:y}){const c=p(!1);r({open:()=>{c.value=!0}});const m=p(),s=p();P.on("deleteFileId",g=>{m.value=g.id,s.value=g.file_name});const C=y,b=async()=>{(await J(m.value,s.value)).status===0?(h({message:"删除文件成功！",type:"success"}),C("success"),c.value=!1):(h.error("删除文件失败！请重新操作"),c.value=!1)};return z(()=>{P.all.clear()}),(g,u)=>{const F=d("el-button"),w=d("el-dialog");return U(),E(w,{modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=t=>c.value=t),title:"删除文件",width:"20%",center:""},{footer:o(()=>[l("div",Q,[e(F,{type:"primary",onClick:b},{default:o(()=>u[1]||(u[1]=[k(" 确认 ")])),_:1})])]),default:o(()=>[u[2]||(u[2]=l("div",{class:"warning-text"},[l("span",null,"您确认删除该文件吗?")],-1))]),_:1},8,["modelValue"])}}}),W=V(R,[["__scopeId","data-v-e5689061"]]),X={class:"table-wrapped"},Y={class:"table-top"},Z={class:"table-header"},ee={class:"upload-wrapped"},te={class:"table-content"},le=["href","onClick"],ae={class:"table-footer"},oe=T({__name:"index",setup(i){const r=p(),y=p({first:"合同管理"}),c=p([]),D=t=>{console.log(t),t.status==0?((async()=>await q(localStorage.getItem("name"),t.url))(),h({message:"上传文件成功!",type:"success"}),b()):h.error("上传文件失败!")},m=p([]),s=A({filesTotal:1,filesPageCount:1,filesCurrentPage:1}),C=async()=>{const t=await H();s.filesTotal=t.length,s.filesPageCount=Math.ceil(t.length/10)};C();const b=async()=>{m.value=await S(1),C()};b();const g=async t=>{s.filesCurrentPage=t,m.value=await S(s.filesCurrentPage)},u=p(),F=t=>{P.emit("deleteFileId",t),u.value.open()},w=async(t,a)=>{G(t,a)};return(t,a)=>{const B=d("Upload"),I=d("el-icon"),x=d("el-button"),N=d("el-upload"),_=d("el-table-column"),O=d("el-table"),$=d("el-pagination");return U(),M(j,null,[e(K,{ref_key:"breadcrumb",ref:r,item:y.value},null,8,["item"]),l("div",X,[l("div",Y,[l("div",Z,[a[3]||(a[3]=l("div",null,null,-1)),l("div",ee,[e(N,{"file-list":c.value,"onUpdate:fileList":a[0]||(a[0]=n=>c.value=n),class:"upload-demo",action:"http://156.245.202.64:3007/file/uploadFile","on-success":D,"show-file-list":!1,multiple:""},{default:o(()=>[e(x,{type:"primary"},{default:o(()=>[a[2]||(a[2]=k("点击上传")),e(I,{class:"el-icon--right"},{default:o(()=>[e(B)]),_:1})]),_:1})]),_:1},8,["file-list"])])]),l("div",te,[e(O,{border:"",data:m.value,style:{width:"100%"}},{default:o(()=>[e(_,{type:"index",width:"50"}),e(_,{prop:"file_name",label:"文件名"}),e(_,{prop:"file_size",label:"文件大小"},{default:o(({row:n})=>{var f;return[l("div",null,L((f=n.file_size)==null?void 0:f.toFixed(2))+" KB",1)]}),_:1}),e(_,{prop:"upload_person",label:"上传者"}),e(_,{prop:"download_number",label:"下载次数"}),e(_,{prop:"upload_time",label:"上传时间"},{default:o(({row:n})=>{var f;return[l("div",null,L((f=n.upload_time)==null?void 0:f.slice(0,10)),1)]}),_:1}),e(_,{label:"操作",width:"300",fixed:"right"},{default:o(({row:n})=>[l("div",null,[e(x,{type:"success",onClick:a[1]||(a[1]=()=>{})},{default:o(()=>[l("a",{href:n.file_url,onClick:f=>w(n.download_number,n.id)},"下载",8,le)]),_:2},1024),e(x,{type:"danger",onClick:f=>F(n)},{default:o(()=>a[4]||(a[4]=[k("删除")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])]),l("div",ae,[e($,{"page-size":1,"pager-count":7,layout:"prev, pager, next",total:s.filesTotal,"page-count":s.filesPageCount,"current-page":s.filesCurrentPage,onCurrentChange:g},null,8,["total","page-count","current-page"])])]),e(W,{ref_key:"tipDelFile",ref:u,onSuccess:b},null,512)],64)}}}),de=V(oe,[["__scopeId","data-v-b7c9e8ab"]]);export{de as default};
