import{T as pe,E as ge}from"./index.esm-Dtw38fWr.js";import{b as M}from"./mitt-CdlF-dbX.js";import{p as te,e as se,g as ce,r as ae,a as _e,b as le,d as ve,f as be}from"./message-CRz6RGfg.js";import{u as fe,d as ye}from"./message-B7MKJIPt.js";import{e as ne}from"./setting-COqKDi4v.js";import{d as ue,r as m,a as Q,s as he,i as W,j as P,w as s,e as g,o as C,f as o,b as e,k as G,c as N,l as X,F as q,h as oe,g as h,E as w,_ as re,t as J}from"./index-DAzvbAht.js";import{r as Ce}from"./delete-DUBxnYnJ.js";import{b as Me}from"./bread_crumb-BVsCHufp.js";import"./index-Cyc5mHF5.js";import"./SvgIcon-CrgHh77p.js";const Ve={class:"dialog-content"},we={style:{border:"1px solid #ccc"}},ke={class:"dialog-footer"},xe=ue({__name:"create",emits:["success"],setup(ie,{expose:F,emit:R}){const T=fe(),O=m("right"),i=m(),t=Q({id:0,message_title:"",message_publish_department:"",message_publish_name:localStorage.getItem("name"),message_category:"",message_receipt_object:"",message_level:"",message_content:""});M.on("createMId",a=>{a==1&&(i.value="发布公告",v.value="",t.message_title="",t.message_publish_department="",t.message_receipt_object="",t.message_level=""),a==2&&(i.value="发布系统消息",v.value="",t.message_title="")}),M.on("editMId",a=>{i.value="编辑公告",v.value="",t.id=a.id,t.message_title=a.message_title,t.message_publish_department=a.message_publish_department,t.message_publish_name=a.message_publish_name,t.message_receipt_object=a.message_receipt_object,t.message_level=a.message_level,t.message_content=a.message_content}),M.on("editSystemMId",a=>{i.value="编辑系统消息",v.value="",t.id=a.id,t.message_title=a.message_title,t.message_publish_name=a.message_publish_name,t.message_content=a.message_content});const k=R,S=async()=>{if(i.value=="发布公告"){t.message_category="公司公告",t.message_content=v.value;const a=await te(t);a.status==0?(w({message:"发布公告成功",type:"success"}),await ye(a.department,a.id),T.returnReadList(localStorage.getItem("id")),k("success"),_.value=!1):(w.error("发布公告失败"),_.value=!1)}i.value=="编辑公告"&&(t.message_content=v.value,(await se(t)).status==0?(w({message:"编辑公告成功",type:"success"}),T.returnReadList(localStorage.getItem("id")),k("success"),_.value=!1):(w.error("编辑公告失败"),_.value=!1)),i.value=="发布系统消息"&&(t.message_category="系统消息",t.message_content=v.value,(await te(t)).status==0?(w({message:"发布系统消息成功",type:"success"}),k("success"),_.value=!1):(w.error("发布系统消息失败"),_.value=!1)),i.value=="编辑系统消息"&&(t.message_content=v.value,(await se(t)).status==0?(w({message:"编辑系统消息成功",type:"success"}),k("success"),_.value=!1):(w.error("编辑系统消息失败"),_.value=!1))},z=m([]),j=m([]);m([]),(async()=>{const a=await ne(),r=[],V=[];for(let y=0;y<a.length;y++){let b={value:a[y]};r.push(b),V.push(b)}z.value=r,V.push({value:"全体成员"}),j.value=V})();const U=he(),x=m("default"),v=m(),B={excludeKeys:[]},H={placeholder:"请输入公告内容...",MENU_CONF:{}};B.excludeKeys=["blockquote","bgColor","color","group-more-style","bulletedList","numberedList","lineHeight","todo","insertLink","group-video","insertTable","codeBlock","divider","fullScreen","group-image"],W(()=>{const a=U.value;a!=null&&a.destroy()});const $=a=>{U.value=a},_=m(!1);F({open:()=>{_.value=!0}});const c=Q({message_title:[{required:!0,message:"请输入公告标题",trigger:"blur"}],message_publish_department:[{required:!0,message:"请选择发布部门",trigger:"blur"}],message_receipt_object:[{required:!0,message:"请选择的接收对象",trigger:"blur"}],message_level:[{required:!0,message:"请选择公告等级",trigger:"blur"}],message_content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]});return W(()=>{M.all.clear()}),(a,r)=>{const V=g("el-input"),y=g("el-form-item"),b=g("el-option"),I=g("el-select"),d=g("el-form"),l=g("el-button"),K=g("el-dialog");return C(),P(K,{modelValue:_.value,"onUpdate:modelValue":r[6]||(r[6]=n=>_.value=n),title:i.value,width:"46%",center:"","align-center":"","destroy-on-close":!0,"append-to-body":""},{footer:s(()=>[o("div",ke,[e(l,{type:"primary",onClick:S},{default:s(()=>r[7]||(r[7]=[h(" 确认 ")])),_:1})])]),default:s(()=>[o("div",Ve,[e(d,{model:t,"label-width":"auto",style:{"max-width":"600px"},rules:c,"label-position":O.value},{default:s(()=>[e(y,{label:"主题",prop:"message_title"},{default:s(()=>[e(V,{modelValue:t.message_title,"onUpdate:modelValue":r[0]||(r[0]=n=>t.message_title=n)},null,8,["modelValue"])]),_:1}),i.value=="发布公告"||i.value=="编辑公告"?(C(),P(y,{key:0,label:"发布部门",prop:"message_publish_department"},{default:s(()=>[e(I,{modelValue:t.message_publish_department,"onUpdate:modelValue":r[1]||(r[1]=n=>t.message_publish_department=n),placeholder:"请选择发布部门"},{default:s(()=>[(C(!0),N(q,null,X(z.value,n=>(C(),P(b,{key:n.value,label:n.value,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):G("",!0),e(y,{label:"发布人",prop:"message_publish_name"},{default:s(()=>[e(V,{modelValue:t.message_publish_name,"onUpdate:modelValue":r[2]||(r[2]=n=>t.message_publish_name=n),disabled:""},null,8,["modelValue"])]),_:1}),i.value=="发布公告"||i.value=="编辑公告"?(C(),P(y,{key:1,label:"接收部门",prop:"message_receipt_object",placeholder:"请选择接收部门"},{default:s(()=>[e(I,{modelValue:t.message_receipt_object,"onUpdate:modelValue":r[3]||(r[3]=n=>t.message_receipt_object=n)},{default:s(()=>[(C(!0),N(q,null,X(j.value,n=>(C(),P(b,{key:n.value,label:n.value,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):G("",!0),i.value=="发布公告"||i.value=="编辑公告"?(C(),P(y,{key:2,label:"公告等级",prop:"message_level"},{default:s(()=>[e(I,{modelValue:t.message_level,"onUpdate:modelValue":r[4]||(r[4]=n=>t.message_level=n),placeholder:"请选择公告等级"},{default:s(()=>[e(b,{label:"一般",value:"一般"}),e(b,{label:"重要",value:"重要"}),e(b,{label:"紧急",value:"紧急"})]),_:1},8,["modelValue"])]),_:1})):G("",!0),e(y,{label:"内容",prop:"message_content"},{default:s(()=>[o("div",we,[e(oe(pe),{style:{"border-bottom":"1px solid #ccc",width:"600px"},editor:U.value,defaultConfig:B,mode:x.value},null,8,["editor","mode"]),e(oe(ge),{style:{height:"300px","overflow-y":"hidden",width:"600px"},modelValue:v.value,"onUpdate:modelValue":r[5]||(r[5]=n=>v.value=n),defaultConfig:H,mode:x.value,onOnCreated:$},null,8,["modelValue","mode"])])]),_:1})]),_:1},8,["model","rules","label-position"])])]),_:1},8,["modelValue","title"])}}}),Le=re(xe,[["__scopeId","data-v-0dfd0577"]]),Pe={class:"module-common-wrapped"},Se={class:"module-common-content"},Te={class:"pane-content"},De={class:"pane-top"},Ue={class:"module-common-header"},Ie={class:"search-wrapped"},je={class:"button-wrapped"},Be={class:"module-common-table"},$e={class:"table-footer"},Ee={class:"pane-content"},Ne={class:"pane-top"},qe={class:"module-common-header"},Fe={class:"button-wrapped"},Re={class:"module-common-table"},Oe={class:"table-footer"},ze=ue({__name:"index",setup(ie){const F=m(),R=m({first:"消息管理",second:"消息列表"}),T=m("first"),O=d=>{},i=m([]),t=m([]),k=m([]),S=m();(async()=>{k.value=await ne()})();const j=async()=>{i.value=await ve(S.value)},D=m(),U=async()=>{i.value=await be(D.value)},x=m(),v=d=>{M.emit("createMId",d),x.value.open()},B=d=>{M.emit("editMId",d),x.value.open()},H=d=>{M.emit("editSystemMId",d),x.value.open()},$=m(),_=d=>{M.emit("firstdeleteMsgId",d),$.value.open()},E=()=>{S.value="",D.value="",r(),b(),a(),b()},c=Q({companyMessageTotal:1,companyMessagePageCount:1,companyMessageCurrentPage:1,systemMessageTotal:1,systemMessagePageCount:1,systemMessageCurrentPage:1}),a=async()=>{const d=await ce();c.companyMessageTotal=d.length,c.companyMessagePageCount=Math.ceil(d.length/10)};a();const r=async()=>{i.value=await ae(1)};r();const V=async d=>{c.companyMessageCurrentPage=d,i.value=await ae(c.companyMessageCurrentPage)};(async()=>{const d=await _e();c.systemMessageTotal=d.length,c.systemMessagePageCount=Math.ceil(d.length/10)})();const b=async()=>{t.value=await le(1)};b();const I=async d=>{c.systemMessageCurrentPage=d,t.value=await le(c.systemMessageCurrentPage)};return W(()=>{M.all.clear()}),(d,l)=>{const K=g("el-option"),n=g("el-select"),A=g("el-radio-button"),de=g("el-radio-group"),L=g("el-button"),p=g("el-table-column"),Y=g("el-table"),Z=g("el-pagination"),ee=g("el-tab-pane"),me=g("el-tabs");return C(),N(q,null,[e(Me,{ref_key:"breadcrumb",ref:F,item:R.value},null,8,["item"]),o("div",Pe,[o("div",Se,[e(me,{modelValue:T.value,"onUpdate:modelValue":l[4]||(l[4]=u=>T.value=u),class:"demo-tabs",stretch:"true",onTabClick:O},{default:s(()=>[e(ee,{label:"公司公告",name:"first"},{default:s(()=>[o("div",Te,[o("div",De,[o("div",Ue,[o("div",Ie,[e(n,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=u=>S.value=u),placeholder:"请选择发布部门以筛选公告",style:{width:"240px"},onChange:j},{default:s(()=>[(C(!0),N(q,null,X(k.value,u=>(C(),P(K,{key:u,label:u,value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(de,{modelValue:D.value,"onUpdate:modelValue":l[1]||(l[1]=u=>D.value=u),onChange:U},{default:s(()=>[e(A,{value:"一般"},{default:s(()=>l[5]||(l[5]=[h("一般")])),_:1}),e(A,{value:"重要"},{default:s(()=>l[6]||(l[6]=[h("重要")])),_:1}),e(A,{value:"紧急"},{default:s(()=>l[7]||(l[7]=[h("紧急")])),_:1})]),_:1},8,["modelValue"])]),o("div",je,[e(L,{type:"primary",onClick:E,plain:"",round:""},{default:s(()=>l[8]||(l[8]=[h("全部公告")])),_:1}),e(L,{type:"primary",onClick:l[2]||(l[2]=u=>v(1)),round:""},{default:s(()=>l[9]||(l[9]=[h("发布公告")])),_:1})])]),o("div",Be,[e(Y,{data:i.value,style:{width:"100%"},border:""},{default:s(()=>[e(p,{type:"index",width:"50"}),e(p,{prop:"message_title",label:"公告主题",width:"240"}),e(p,{prop:"message_category",label:"类别"}),e(p,{prop:"message_publish_department",label:"发布部门",width:"140"}),e(p,{prop:"message_publish_name",label:"发布人"}),e(p,{prop:"message_receipt_object",label:"接收部门",width:"140"}),e(p,{prop:"message_level",label:"公告等级",width:"100"}),e(p,{prop:"message_publish_time",label:"发布时间",width:"200"},{default:s(({row:u})=>{var f;return[o("div",null,J((f=u.message_publish_time)==null?void 0:f.slice(0,10)),1)]}),_:1}),e(p,{prop:"message_update_time",label:"最新编辑时间",width:"200"},{default:s(({row:u})=>{var f;return[o("div",null,J((f=u.message_update_time)==null?void 0:f.slice(0,10)),1)]}),_:1}),e(p,{prop:"message_click_number",label:"阅读人数"}),e(p,{label:"操作",width:"300",fixed:"right"},{default:s(({row:u})=>[o("div",null,[e(L,{type:"success",onClick:f=>B(u)},{default:s(()=>l[10]||(l[10]=[h("编辑")])),_:2},1032,["onClick"]),e(L,{type:"danger",onClick:f=>_(u)},{default:s(()=>l[11]||(l[11]=[h("删除")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])]),o("div",$e,[e(Z,{"page-size":1,"pager-count":7,layout:"prev, pager, next",total:c.companyMessageTotal,"page-count":c.companyMessagePageCount,"current-page":c.companyMessageCurrentPage,onCurrentChange:V},null,8,["total","page-count","current-page"])])])]),_:1}),e(ee,{label:"系统消息",name:"second"},{default:s(()=>[o("div",Ee,[o("div",Ne,[o("div",qe,[l[13]||(l[13]=o("div",{class:"search-wrapped"},null,-1)),o("div",Fe,[e(L,{type:"primary",onClick:l[3]||(l[3]=u=>v(2)),round:""},{default:s(()=>l[12]||(l[12]=[h("发布系统消息")])),_:1})])]),o("div",Re,[e(Y,{data:t.value,style:{width:"100%"},border:""},{default:s(()=>[e(p,{type:"index",width:"50"}),e(p,{prop:"message_title",label:"消息主题"}),e(p,{prop:"message_publish_name",label:"发布者"}),e(p,{prop:"message_click_number",label:"阅读人数"}),e(p,{prop:"message_publish_time",label:"发布时间",width:"200"},{default:s(({row:u})=>{var f;return[o("div",null,J((f=u.message_publish_time)==null?void 0:f.slice(0,10)),1)]}),_:1}),e(p,{label:"操作",width:"300",fixed:"right"},{default:s(({row:u})=>[o("div",null,[e(L,{type:"success",onClick:f=>H(u)},{default:s(()=>l[14]||(l[14]=[h("编辑")])),_:2},1032,["onClick"]),e(L,{type:"danger",onClick:f=>_(u)},{default:s(()=>l[15]||(l[15]=[h("删除")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])]),o("div",Oe,[e(Z,{"page-size":1,"pager-count":7,layout:"prev, pager, next",total:c.systemMessageTotal,"page-count":c.systemMessagePageCount,"current-page":c.systemMessageCurrentPage,onCurrentChange:I},null,8,["total","page-count","current-page"])])])]),_:1})]),_:1},8,["modelValue"])])]),e(Le,{ref_key:"createM",ref:x,onSuccess:E},null,512),e(Ce,{ref_key:"deletem",ref:$,onSuccess:E},null,512)],64)}}}),et=re(ze,[["__scopeId","data-v-1544b4d7"]]);export{et as default};
