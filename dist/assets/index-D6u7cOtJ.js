import{d as j,r as _,i as M,j as L,w as a,e as u,o as x,b as e,g as V,f as r,E as w,_ as h,a as S,c as F,l as J,F as T,t as P,k as H,h as te,y as ae}from"./index-DAzvbAht.js";import{e as K}from"./setting-COqKDi4v.js";import{t as O}from"./operation-DqFEevio.js";import{b as le}from"./bread_crumb-BVsCHufp.js";import{j as ne,h as oe,i as se,r as B,s as re,g as ue,k as de,l as ie,m as pe,n as me}from"./userinfor-5i_LEdTx.js";import{b as v}from"./mitt-CdlF-dbX.js";import{_ as ce}from"./delete_admin.vue_vue_type_script_setup_true_lang-C_A0FCbJ.js";import"./index-Cyc5mHF5.js";import"./operation_log-B2181nWq.js";import"./SvgIcon-CrgHh77p.js";const _e={class:"dialog-footer"},fe=j({__name:"promote",setup(R,{expose:D}){const l=_(),k=_();v.on("promoteId",b=>{l.value=b.id,k.value=b.name});const o=_(),c=async()=>{(await ne(l.value,o.value)).status===0?(w({message:"创建管理员账号成功！",type:"success"}),O("用户",localStorage.getItem("name"),k.value,"高级",1),v.emit("offDialog",1),g.value=!1):(w.error("创建管理员账号失败，请重新创建"),g.value=!1)},g=_(!1);return D({open:()=>{g.value=!0}}),M(()=>{v.all.clear()}),(b,d)=>{const n=u("el-radio"),t=u("el-radio-group"),s=u("el-button"),C=u("el-dialog");return x(),L(C,{modelValue:g.value,"onUpdate:modelValue":d[1]||(d[1]=y=>g.value=y),title:"赋权操作",width:"30%",center:""},{footer:a(()=>[r("span",_e,[e(s,{type:"primary",onClick:c},{default:a(()=>d[5]||(d[5]=[V(" 确认 ")])),_:1})])]),default:a(()=>[e(t,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=y=>o.value=y)},{default:a(()=>[e(n,{label:"产品管理员",size:"large",border:""},{default:a(()=>d[2]||(d[2]=[V("产品管理员")])),_:1}),e(n,{label:"用户管理员",size:"large",border:""},{default:a(()=>d[3]||(d[3]=[V("用户管理员")])),_:1}),e(n,{label:"消息管理员",size:"large",border:""},{default:a(()=>d[4]||(d[4]=[V("消息管理员")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),ge=h(fe,[["__scopeId","data-v-ede09838"]]),ve={class:"dialog-content"},be={class:"dialog-footer"},ye=j({__name:"edit_user",setup(R,{expose:D}){const l=_([]);(async()=>{l.value=await K()})(),v.on("editId",async d=>{const n=await oe(d);o.id=n.id,o.account=n.account,o.name=n.name,o.sex=n.sex,o.email=n.email,o.department=n.department});const o=S({id:null,account:null,name:"",sex:"",email:"",department:"",identity:"用户"}),c=S({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}],department:[{required:!0,message:"请选择部门",trigger:"blur"}]}),g=_(!1);D({open:()=>{g.value=!0}});const b=async()=>{(await se(o)).status===0?(w({message:"编辑用户信息成功！",type:"success"}),v.emit("offDialog",2),g.value=!1):(w.error("编辑用户信息失败!"),g.value=!1)};return M(()=>{v.all.clear()}),(d,n)=>{const t=u("el-input"),s=u("el-form-item"),C=u("el-option"),y=u("el-select"),A=u("el-form"),E=u("el-button"),q=u("el-dialog");return x(),L(q,{modelValue:g.value,"onUpdate:modelValue":n[5]||(n[5]=p=>g.value=p),title:"编辑用户信息",width:"600px","align-center":"",draggable:""},{footer:a(()=>[r("div",be,[e(E,{type:"primary",onClick:b},{default:a(()=>n[6]||(n[6]=[V(" 确认 ")])),_:1})])]),default:a(()=>[r("div",ve,[e(A,{ref:"ruleFormRef",model:o,rules:c,"label-width":"60px"},{default:a(()=>[e(s,{label:"账号",prop:"account"},{default:a(()=>[e(t,{modelValue:o.account,"onUpdate:modelValue":n[0]||(n[0]=p=>o.account=p),disabled:""},null,8,["modelValue"])]),_:1}),e(s,{label:"姓名",prop:"name"},{default:a(()=>[e(t,{modelValue:o.name,"onUpdate:modelValue":n[1]||(n[1]=p=>o.name=p)},null,8,["modelValue"])]),_:1}),e(s,{label:"性别",prop:"sex"},{default:a(()=>[e(y,{modelValue:o.sex,"onUpdate:modelValue":n[2]||(n[2]=p=>o.sex=p),placeholder:"请选择性别"},{default:a(()=>[e(C,{label:"男",value:"男"}),e(C,{label:"女",value:"女"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"邮箱",prop:"email"},{default:a(()=>[e(t,{modelValue:o.email,"onUpdate:modelValue":n[3]||(n[3]=p=>o.email=p)},null,8,["modelValue"])]),_:1}),e(s,{label:"部门",prop:"department"},{default:a(()=>[e(y,{modelValue:o.department,"onUpdate:modelValue":n[4]||(n[4]=p=>o.department=p),placeholder:"请选择部门"},{default:a(()=>[(x(!0),F(T,null,J(l.value,p=>(x(),L(C,{key:p,label:p,value:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])}}}),Ve=h(ye,[["__scopeId","data-v-1bab9293"]]),xe={key:0},ke={key:1},Ce=j({__name:"user_info",setup(R,{expose:D}){v.on("userId",t=>{l.id=t.id,l.imageUrl=t.image_url,l.account=t.account,l.name=t.name,l.sex=t.sex,l.department=t.department,l.email=t.email,l.status=t.status});const l=S({id:0,imageUrl:"",account:0,name:"",sex:"",department:"",email:"",status:0});v.on("offDialog",t=>{t&&(d.value=!1)});const k=_(),o=t=>{let s={id:t,account:l.account,name:l.name};v.emit("promoteId",s),k.value.open()},c=_(),g=t=>{v.emit("editId",t),c.value.open()},z=_(),b=t=>{let s={id:t,account:l.account,name:l.name};v.emit("deleteUserId",s),z.value.open()},d=_(!1);return D({open:()=>{d.value=!0}}),M(()=>{v.all.clear()}),(t,s)=>{const C=u("el-avatar"),y=u("el-aside"),A=u("el-main"),E=u("el-container"),q=u("el-footer"),p=u("el-dialog");return x(),F(T,null,[e(p,{modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=I=>d.value=I),title:" 用户信息",width:"500px",draggable:"",class:"userInfoDialog"},{default:a(()=>[e(E,null,{default:a(()=>[e(y,{width:"200px"},{default:a(()=>[e(C,{size:120,src:l.imageUrl},null,8,["src"])]),_:1}),e(A,null,{default:a(()=>[r("div",null,"账号: "+P(l.account),1),r("div",null,"姓名: "+P(l.name),1),r("div",null,"性别: "+P(l.sex),1),r("div",null,"部门: "+P(l.department),1),r("div",null,"邮箱: "+P(l.email),1),r("div",null,[s[4]||(s[4]=V("状态： ")),l.status==0?(x(),F("span",xe,"正常")):H("",!0),l.status==1?(x(),F("span",ke,"冻结")):H("",!0)])]),_:1})]),_:1}),e(q,null,{default:a(()=>[r("span",{onClick:s[0]||(s[0]=I=>g(l.id))},"编辑"),r("span",{onClick:s[1]||(s[1]=I=>o(l.id))},"赋权"),r("span",{onClick:s[2]||(s[2]=I=>b(l.id))},"删除用户")]),_:1})]),_:1},8,["modelValue"]),e(ge,{ref_key:"pro",ref:k},null,512),e(Ve,{ref_key:"edituser",ref:c},null,512),e(ce,{ref_key:"deleteuser",ref:z},null,512)],64)}}}),Ue=h(Ce,[["__scopeId","data-v-7e8ab30f"]]),we={class:"table-wrapped"},De={class:"table-top"},Ie={class:"table-header"},$e={class:"left_wrapped"},Pe={class:"search-wrapped"},Be={class:"select-wrapped"},Le={class:"button-wrapped",width:"232"},Fe={class:"table-content"},ze={class:"table-footer"},he=j({__name:"index",setup(R){const D=_(),l=_({first:"用户管理",second:"用户列表"}),k=_(),o=_([]),c=_([]),g=async()=>{c.value=await re(k.value,"用户")};(async()=>{o.value=await K()})();const b=_(),d=async()=>{b.value&&(c.value=await pe(b.value))},n=()=>{y()},t=S({pageCount:1,currentPage:1}),s=_(0),C=async()=>{const f=await ue("用户");s.value=f.length,t.pageCount=Math.ceil(f.length/10),console.log(f)};C();const y=async()=>{c.value=await B(1,"用户")};y();const A=async f=>{t.currentPage=f,c.value=await B(t.currentPage,"用户")},E=async()=>{c.value=await me()},q=async f=>{(await de(f.id)).status===0?(w({message:"冻结用户成功！",type:"success"}),c.value=await B(t.currentPage,"用户"),O("用户登录状态",localStorage.getItem("name"),f.name,"中级",0)):w.error("冻结用户失败!")},p=async f=>{(await ie(f.id)).status===0?(w({message:"解冻用户成功！",type:"success"}),c.value=await B(t.currentPage,"用户"),O("用户登录状态",localStorage.getItem("name"),f.name,"中级",1)):w.error("解冻用户失败!")},I=_(),Q=f=>{v.emit("userId",f),I.value.open()};return v.on("offDialog",async f=>{const i=t.currentPage;f&&(c.value=await B(t.currentPage,"用户"),c.value.length==0&&(t.currentPage=i-1,c.value=await B(t.currentPage,"用户"),C()))}),M(()=>{v.all.clear()}),(f,i)=>{const W=u("el-input"),X=u("el-option"),Y=u("el-select"),N=u("el-button"),U=u("el-table-column"),G=u("el-tag"),Z=u("el-table"),ee=u("el-pagination");return x(),F(T,null,[e(le,{ref_key:"breadcrumb",ref:D,item:l.value},null,8,["item"]),r("div",we,[r("div",De,[r("div",Ie,[r("div",$e,[r("div",Pe,[e(W,{modelValue:k.value,"onUpdate:modelValue":i[0]||(i[0]=m=>k.value=m),style:{width:"240px"},placeholder:"输入账号进行搜索","suffix-icon":te(ae),onChange:i[1]||(i[1]=m=>g())},null,8,["modelValue","suffix-icon"])]),r("div",Be,[e(Y,{modelValue:b.value,"onUpdate:modelValue":i[2]||(i[2]=m=>b.value=m),placeholder:"请选择部门",clearable:"",onChange:d,onClear:n},{default:a(()=>[(x(!0),F(T,null,J(o.value,m=>(x(),L(X,{key:m,label:m,value:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),r("div",Le,[e(N,{type:"primary",plain:"",onClick:E},{default:a(()=>i[3]||(i[3]=[V("筛选冻结用户")])),_:1}),e(N,{type:"primary",plain:"",onClick:y},{default:a(()=>i[4]||(i[4]=[V("显示全部用户")])),_:1})])]),r("div",Fe,[e(Z,{data:c.value,style:{width:"100%"},border:"",onRowDblclick:Q},{default:a(()=>[e(U,{type:"index"}),e(U,{prop:"account",label:"账号"}),e(U,{prop:"name",label:"姓名"}),e(U,{prop:"sex",label:"性别"}),e(U,{prop:"department",label:"部门"}),e(U,{prop:"email",label:"邮箱"}),e(U,{prop:"status",label:"状态"},{default:a(({row:m})=>[r("div",null,[m.status==1?(x(),L(G,{key:0,type:"primary"},{default:a(()=>i[5]||(i[5]=[V("冻结")])),_:1})):(x(),L(G,{key:1,type:"success"},{default:a(()=>i[6]||(i[6]=[V("正常")])),_:1}))])]),_:1}),e(U,{prop:"creat_time",label:"创建时间"},{default:a(({row:m})=>{var $;return[r("div",null,P(($=m.creat_time)==null?void 0:$.slice(0,10)),1)]}),_:1}),e(U,{prop:"update_time",label:"更新时间"},{default:a(({row:m})=>{var $;return[r("div",null,P(($=m.update_time)==null?void 0:$.slice(0,10)),1)]}),_:1}),e(U,{label:"操作",width:"180"},{default:a(({row:m})=>[r("div",null,[e(N,{type:"primary",round:"",onClick:$=>q(m),disabled:m.status==1},{default:a(()=>i[7]||(i[7]=[V("冻结")])),_:2},1032,["onClick","disabled"]),e(N,{type:"success",round:"",onClick:$=>p(m),disabled:m.status==0},{default:a(()=>i[8]||(i[8]=[V("解冻")])),_:2},1032,["onClick","disabled"])])]),_:1})]),_:1},8,["data"])])]),r("div",ze,[e(ee,{"page-size":1,"pager-count":7,layout:"prev, pager, next",total:s.value,"page-count":t.pageCount,"current-page":t.currentPage,onCurrentChange:A},null,8,["total","page-count","current-page"])])]),e(Ue,{ref_key:"userCard",ref:I},null,512)],64)}}});export{he as default};
